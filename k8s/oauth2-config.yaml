apiVersion: v1
kind: ConfigMap
metadata:
  name: oauth2-proxy-sidecar-config
  namespace: default
data:
  oauth2_proxy.cfg: |
    # OAuth2 Proxy Configuration for Inker
    provider = "github"
    provider_display_name = "GitHub"
    
    # Redirect URL (must match GitHub OAuth app configuration)
    redirect_url = "https://inker.cat-herding.net/oauth2/callback"
    
    # Upstreams
    upstreams = [
      "http://127.0.0.1:8080"
    ]
    
    # Email domain restrictions (optional)
    email_domains = ["*"]
    
    # Cookie settings
    cookie_name = "_oauth2_proxy_inker"
    cookie_secure = true
    cookie_httponly = true
    cookie_samesite = "lax"
    cookie_domains = [".cat-herding.net"]
    
    # Session settings
    session_cookie_minimal = true
    
    # Reverse proxy settings
    reverse_proxy = true
    real_client_ip_header = "X-Forwarded-For"
    
    # Logging
    request_logging = true
    auth_logging = true
    standard_logging = true
    
    # Skip auth for health endpoints
    skip_auth_routes = [
      "^/health$",
      "^/healthz$",
      "^/ping$"
    ]
    
    # Ports
    http_address = "0.0.0.0:4180"
    
    # Whitelist domains for redirects
    whitelist_domains = [".cat-herding.net"]
